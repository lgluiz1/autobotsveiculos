{% extends 'base/base.html' %}
{% load static %}

{% block content %}
<div style="position: relative; display: flex; align-items: center; justify-content: center;">
    <section class="hero">
        <video autoplay loop muted playsinline>
            <source src="{% static 'video/video.webm' %}" type="video/webm">
            Seu navegador não suporta vídeo.
        </video>
        <h1>Autobots Veículos</h1>
        <p>Transformando o jeito de comprar seu carro!</p>
    </section>
    <section class="formulario">
    <form action="{% url 'pesquisa' %}" method="get">
        <h1>Encontre o carro perfeito <span class="text-animation" style="color: #ffcc00;">Melhor preço</span></h1>
        <div>
            <select name="marca" id="marca" onchange="carregarModelos()">
                <option value="">Marca</option>
                {% for marca in marcas %}
                <option value="{{ marca.id }}">{{ marca.nome }}</option>
                {% endfor %}
            </select>

            <select id="modelo" name="modelo">
                <option value="">Todos</option>
            </select>

            <select name="preco_max" id="">
                <option value="">Valor Máximo</option>
                <option value="10000">R$ 10.000,00</option>
                <option value="30000">R$ 30.000,00</option>
                <option value="70000">R$ 70.000,00</option>
                <option value="100000">R$ 100.000,00</option>
                <option value="150000">R$ 150.000,00</option>
                <option value="200000">R$ 200.000,00</option>
                <option value="500000">R$ 500.000,00</option>
                <option value="1000000">R$ 1.000.000,00</option>
            </select>

            <button type="submit">Localizar</button>
        </div>
    </form>
</section>

</div>
<div class="container">
    <h1 class="text-color">Ofertas Imperdíveis</h1>

    <section class="veiculos">

        {% for carro in carros %}
        {% if carro.destaque %}
        <div class="card">
            <img src="{{ carro.imagem_principal.url }}" alt="{{ carro.modelo }}">
            <div class="card-content">
                <h3>{{ carro.marca }} {{ carro.modelo }}</h3>
                <p>Ano: {{ carro.ano }} | {{ carro.cambio }} | {{ carro.combustivel }}</p>
                <p>Preço: R$ {{ carro.preco }}</p>
                <a href="{% url 'detalhes' carro.id %}" class="btn-card">Ver Detalhes</a>
            </div>
        </div>
        {% else %}

        <div class="card">
            <img src="{{ carro.imagem_principal.url }}" alt="{{ carro.modelo }}">
            <div class="card-content">
                <h3>{{ carro.marca }} {{ carro.modelo }}</h3>
                <p>Ano: {{ carro.ano }} | {{ carro.cambio }} | {{ carro.combustivel }}</p>
                <p>Preço: R$ {{ carro.preco }}</p>
                <a href="{% url 'detalhes' carro.id %}" class="btn-card">Ver Detalhes</a>
            </div>
        </div>

        {% endif %}
        {% empty %}
        <p>Nenhum veículo disponível no momento.</p>
        {% endfor %}

    </section>
</div>

<script>

function carregarModelos() {
    const marcaId = document.getElementById('marca').value;
    const modeloSelect = document.getElementById('modelo');

    modeloSelect.innerHTML = '<option value="">Todos</option>';

    if (marcaId) {
        fetch(`/get-modelos/${marcaId}/`)
            .then(response => {
                if (!response.ok) throw new Error('Erro ao carregar modelos: ' + response.status);
                return response.json();
            })
            .then(data => {
                data.forEach(modelo => {
                    const option = document.createElement('option');
                    option.value = modelo.id;
                    option.textContent = modelo.nome;
                    modeloSelect.appendChild(option);
                });
            })
            .catch(err => console.error(err));
    }
}
</script>


{% endblock %}